---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allWriting = await getCollection('writing');
const sortedWriting = allWriting.sort(
  (a, b) => b.data.publishedDate.valueOf() - a.data.publishedDate.valueOf()
);

const typeLabels: Record<string, string> = {
  article: 'Article',
  podcast: 'Podcast',
  talk: 'Talk',
};

const formatDate = (date: Date): string =>
  date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
---

<BaseLayout
  title="Writing | Ian Cook, PhD | Fierce Highways"
  description="Articles, podcasts, and talks on AI, machine learning, and data science."
>
  <section class="section-spacing">
    <div class="container-wide">
      <p class="label text-sienna mb-4">Writing & Podcasts</p>
      <h1 class="text-3xl md:text-4xl font-display font-bold mb-4">
        Thoughts on AI
      </h1>
      <p class="type-lead max-w-2xl mb-12">
        Articles, podcast appearances, and talks on AI, machine learning, and the future of data science.
      </p>

      <div class="space-y-8">
        {sortedWriting.map((piece) => (
          <article class="flex gap-6 items-start pb-8 border-b border-parchment last:border-0">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="label">{typeLabels[piece.data.type]}</span>
                {piece.data.venue && (
                  <>
                    <span class="text-stone text-sm">&middot;</span>
                    <span class="text-stone text-sm">{piece.data.venue}</span>
                  </>
                )}
              </div>

              <h2 class="text-xl font-display font-bold mb-2">
                {piece.data.externalUrl ? (
                  <a
                    href={piece.data.externalUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="no-underline hover:text-sienna transition-colors"
                  >
                    {piece.data.title}
                  </a>
                ) : (
                  piece.data.title
                )}
              </h2>

              <p class="text-ink-light text-sm mb-3">
                {piece.data.description}
              </p>

              <p class="text-stone text-sm">
                {formatDate(piece.data.publishedDate)}
              </p>
            </div>

            {piece.data.externalUrl && (
              <a
                href={piece.data.externalUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex-shrink-0 text-sienna text-sm font-medium no-underline hover:underline"
              >
                {piece.data.type === 'podcast' ? 'Listen' : 'Read'} &rarr;
              </a>
            )}
          </article>
        ))}
      </div>
    </div>
  </section>

  <section class="section-spacing bg-cream-dark">
    <div class="container-editorial text-center">
      <h2 class="text-2xl font-display font-bold mb-4">Want to Chat?</h2>
      <p class="type-lead mx-auto mb-8">
        Interested in having me on your podcast or at your event?
      </p>
      <a
        href="/contact"
        class="inline-block px-6 py-3 bg-sienna text-cream font-medium text-sm tracking-wide uppercase no-underline hover:bg-sienna-dark transition-colors"
      >
        Get in Touch
      </a>
    </div>
  </section>
</BaseLayout>
